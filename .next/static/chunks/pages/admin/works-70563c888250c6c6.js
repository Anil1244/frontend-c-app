(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[901],{3184:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/works",function(){return a(2869)}])},2869:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var r=a(5893),s=a(7294),n=a(7066),c=a(1163);let i="http://localhost:4000";function o(e){let{session:t}=e,[a,o]=(0,s.useState)([]),[l,u]=(0,s.useState)([]),[d,h]=(0,s.useState)(""),[p,_]=(0,s.useState)([]),[m,x]=(0,s.useState)(null),[k,b]=(0,s.useState)(null),j=(0,c.useRouter)();async function w(){let e=localStorage.getItem("backend_token"),t=await n.Z.get("".concat(i,"/api/resources"),{headers:{Authorization:"Bearer ".concat(e)}});u(t.data);let a=await n.Z.get("".concat(i,"/api/works"),{headers:{Authorization:"Bearer ".concat(e)}});o(a.data)}async function f(e){e.preventDefault();let t=localStorage.getItem("backend_token");m?await n.Z.put("".concat(i,"/api/works/").concat(m.id),{name:d,resources:p.map(e=>({resource_id:e.resource_id,quantity_per_unit_work:e.quantity_per_unit_work}))},{headers:{Authorization:"Bearer ".concat(t)}}):await n.Z.post("".concat(i,"/api/works"),{name:d,resources:p.map(e=>({resource_id:e.resource_id,quantity_per_unit_work:e.quantity_per_unit_work}))},{headers:{Authorization:"Bearer ".concat(t)}}),h(""),_([]),x(null),w()}async function N(e){let t=localStorage.getItem("backend_token");await n.Z.delete("".concat(i,"/api/works/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}}),w()}return(0,s.useEffect)(()=>{let e=localStorage.getItem("user_role");"admin"!==e?j.push("/"):(b(e),w())},[j]),t&&"admin"===k?(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h1",{className:"text-xl font-bold mb-4",children:"Manage Works"}),(0,r.jsxs)("form",{onSubmit:f,className:"space-y-2 mb-4",children:[(0,r.jsx)("input",{type:"text",placeholder:"Work Name",className:"border p-2 w-full",value:d,onChange:e=>h(e.target.value)}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"font-bold mb-2",children:"Add Resources to Work"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:l.map(e=>(0,r.jsx)("button",{type:"button",className:"bg-gray-200 px-2 py-1 rounded",onClick:()=>{p.find(t=>t.resource_id===e.id)||_([...p,{resource_id:e.id,resource_name:e.name,quantity_per_unit_work:0}])},children:e.name},e.id))}),(0,r.jsxs)("table",{className:"min-w-full bg-white",children:[(0,r.jsx)("thead",{className:"bg-gray-200",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 text-left",children:"Resource"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Qty/Unit Work"})]})}),(0,r.jsx)("tbody",{children:p.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"p-2",children:e.resource_name}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("input",{type:"number",className:"border p-1 w-full",value:e.quantity_per_unit_work,onChange:t=>{var a,r;return a=e.resource_id,r=t.target.value,void _(p.map(e=>e.resource_id===a?{...e,quantity_per_unit_work:parseFloat(r)}:e))}})})]},e.resource_id))})]})]}),(0,r.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",type:"submit",children:m?"Update Work":"Add Work"})]}),(0,r.jsx)("h2",{className:"font-bold mb-2",children:"Existing Works"}),(0,r.jsxs)("table",{className:"min-w-full bg-white",children:[(0,r.jsx)("thead",{className:"bg-gray-200",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 text-left",children:"Work"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Resources"}),(0,r.jsx)("th",{className:"p-2 text-left"})]})}),(0,r.jsx)("tbody",{children:a.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"p-2",children:e.name}),(0,r.jsx)("td",{className:"p-2",children:e.resources.map(e=>(0,r.jsxs)("div",{children:[e.resource_name,": ",e.quantity_per_unit_work," ",e.unit," per unit work"]},e.resource_id))}),(0,r.jsxs)("td",{className:"p-2 space-x-2",children:[(0,r.jsx)("button",{onClick:()=>{h(e.name),_(e.resources.map(e=>({resource_id:e.resource_id,resource_name:e.resource_name,quantity_per_unit_work:e.quantity_per_unit_work}))),x(e)},className:"text-blue-600 underline",children:"Edit"}),(0,r.jsx)("button",{onClick:()=>N(e.id),className:"text-red-600 underline",children:"Delete"})]})]},e.id))})]})]}):(0,r.jsx)("div",{children:"Loading..."})}}},function(e){e.O(0,[66,774,888,179],function(){return e(e.s=3184)}),_N_E=e.O()}]);