(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[92],{4937:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/projects/[id]",function(){return a(7539)}])},7539:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var s=a(5893),c=a(7294),n=a(1163),l=a(7066);let r="http://localhost:4000";function o(e){let{session:t}=e,a=(0,n.useRouter)(),{id:o}=a.query,[i,d]=(0,c.useState)(null),[u,h]=(0,c.useState)([]),[m,p]=(0,c.useState)([]),[j,x]=(0,c.useState)(null),[b,N]=(0,c.useState)(""),[f,w]=(0,c.useState)("");async function _(){let e=localStorage.getItem("backend_token"),t=await l.Z.get("".concat(r,"/api/projects/").concat(o),{headers:{Authorization:"Bearer ".concat(e)}});d(t.data),p(t.data.works.map(e=>({work_id:e.work_id,name:e.works.name,quantity:e.quantity}))),N(t.data.project_name+" Clone"),w(t.data.project_address)}async function g(){let e=localStorage.getItem("backend_token"),t=await l.Z.get("".concat(r,"/api/works"),{headers:{Authorization:"Bearer ".concat(e)}});h(t.data)}async function y(e){e.preventDefault();let t=localStorage.getItem("backend_token");await l.Z.put("".concat(r,"/api/projects/").concat(o),{works:m.map(e=>({work_id:e.work_id,quantity:e.quantity}))},{headers:{Authorization:"Bearer ".concat(t)}}),_(),alert("Project updated")}async function k(){let e=localStorage.getItem("backend_token"),t=await l.Z.get("".concat(r,"/api/projects/").concat(o,"/calculate"),{headers:{Authorization:"Bearer ".concat(e)}});x(t.data)}async function v(){let e=localStorage.getItem("backend_token"),t=await l.Z.post("".concat(r,"/api/projects/").concat(o,"/clone"),{new_project_name:b,new_project_address:f},{headers:{Authorization:"Bearer ".concat(e)}});alert("Project cloned successfully"),a.push("/projects/".concat(t.data.project.id))}return(0,c.useEffect)(()=>{t&&o&&(_(),g())},[t,o]),t&&i?(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("h1",{className:"text-xl font-bold mb-4",children:["Project: ",i.project_name]}),(0,s.jsxs)("form",{onSubmit:y,className:"space-y-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"font-bold mb-2",children:"Works in Project"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:u.map(e=>(0,s.jsx)("button",{type:"button",className:"bg-gray-200 px-2 py-1 rounded",onClick:()=>{m.find(t=>t.work_id===e.id)||p([...m,{work_id:e.id,name:e.name,quantity:0}])},children:e.name},e.id))}),(0,s.jsxs)("table",{className:"min-w-full bg-white",children:[(0,s.jsx)("thead",{className:"bg-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 text-left",children:"Work"}),(0,s.jsx)("th",{className:"p-2 text-left",children:"Quantity"})]})}),(0,s.jsx)("tbody",{children:m.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-2",children:e.name}),(0,s.jsx)("td",{className:"p-2",children:(0,s.jsx)("input",{type:"number",className:"border p-1 w-full",value:e.quantity,onChange:t=>{var a,s;return a=e.work_id,s=t.target.value,void p(m.map(e=>e.work_id===a?{...e,quantity:parseFloat(s)}:e))}})})]},e.work_id))})]})]}),(0,s.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",type:"submit",children:"Update Project"})]}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded mr-2",onClick:k,children:"Calculate Totals"})}),j&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h2",{className:"font-bold mb-2",children:"Calculation Results"}),(0,s.jsxs)("table",{className:"min-w-full bg-white mb-2",children:[(0,s.jsx)("thead",{className:"bg-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 text-left",children:"Resource"}),(0,s.jsx)("th",{className:"p-2 text-left",children:"Unit"}),(0,s.jsx)("th",{className:"p-2 text-left",children:"Quantity"}),(0,s.jsx)("th",{className:"p-2 text-left",children:"Rate"}),(0,s.jsx)("th",{className:"p-2 text-left",children:"Amount"})]})}),(0,s.jsxs)("tbody",{children:[j.resources.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"p-2",children:e.resource_name}),(0,s.jsx)("td",{className:"p-2",children:e.unit}),(0,s.jsx)("td",{className:"p-2",children:e.quantity}),(0,s.jsx)("td",{className:"p-2",children:e.rate}),(0,s.jsx)("td",{className:"p-2",children:e.amount})]},e.resource_name)),(0,s.jsxs)("tr",{className:"font-bold bg-gray-200",children:[(0,s.jsx)("td",{className:"p-2",colSpan:4,children:"Total"}),(0,s.jsx)("td",{className:"p-2",children:j.total_cost})]})]})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h2",{className:"font-bold mb-2",children:"Clone Project"}),(0,s.jsx)("input",{type:"text",placeholder:"New Project Name",className:"border p-2 w-full mb-2",value:b,onChange:e=>N(e.target.value)}),(0,s.jsx)("input",{type:"text",placeholder:"New Project Address",className:"border p-2 w-full mb-2",value:f,onChange:e=>w(e.target.value)}),(0,s.jsx)("button",{className:"bg-purple-600 text-white px-4 py-2 rounded",onClick:v,children:"Clone Project"})]})]}):(0,s.jsx)("div",{children:"Loading..."})}}},function(e){e.O(0,[66,774,888,179],function(){return e(e.s=4937)}),_N_E=e.O()}]);